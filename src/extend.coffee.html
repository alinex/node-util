<!DOCTYPE html>
<html>
<head>
  <title>extend.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../";
    var thisFile = "home/alex/github/node-util/src/extend.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" /></head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io"
  onmouseover="logo.src='https://alinex.github.io/images/Alinex-200.png'"
  onmouseout="logo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="logo" src="https://alinex.github.io/images/Alinex-black-200.png"
    width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png"
    style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog"
    class="btn btn-primary"><span class="glyphicon-pencil"></span> Blog</a>
  <a href="http://alinex.github.io/develop"
    class="btn btn-primary"><span class="glyphicon-book"></span> Develop</a>
  <a href="http://alinex.github.io/code.html"
    class="btn btn-warning"><span class="glyphicon-cog"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#utility-functions-for-objects">Utility functions for objects.</a>
      </div>

      <div class="heading h2">
        <a href="#node-modules">Node modules</a>
      </div>

      <div class="heading h2">
        <a href="#indention">Indention</a>
      </div>

      <div class="heading h2">
        <a href="#extend-object">Extend object</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-util" title="Fork me on GitHub"></a>
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="utility-functions-for-objects">
  <h1>
    <a href="#utility-functions-for-objects" name="utility-functions-for-objects" class="pilcrow"></a>
Utility functions for objects.
  </h1>
</div>

        </td>
        <td class="code highlight">
          
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="node-modules">
  <h2>
    <a href="#node-modules" name="node-modules" class="pilcrow"></a>
Node modules
  </h2>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'util:extend'</span>)
util = <span class="hljs-built_in">require</span> <span class="hljs-string">'util'</span>
chalk = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>internal modules</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">clone = <span class="hljs-built_in">require</span> <span class="hljs-string">'./clone'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="indention">
  <h2>
    <a href="#indention" name="indention" class="pilcrow"></a>
Indention
  </h2>
</div>
<p>Because the function works synchrone, the indent variable can be used accross
all calls to show the level in the debug messages. It is set to 3 spaces for
the initial call increased by 3 every subcall.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">indent = <span class="hljs-string">''</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="extend-object">
  <h2>
    <a href="#extend-object" name="extend-object" class="pilcrow"></a>
Extend object
  </h2>
</div>
<p>This method will extend a given object with the entries from additional
objects. Therefore it will do a deep extend.</p>
<p><strong>Arguments:</strong></p>
<ul>
<li><code>mode</code>
optional string 'MODE ...' defining how the extend should work</li>
<li><code>object</code>
base object to be extended</li>
<li><code>extender</code>...
multiple extenders may be given with will be cloned into the object.</li>
</ul>
<p><strong>Returns:</strong></p>
<ul>
<li><code>object</code>
the given and maybe changed object.</li>
</ul>
<p><strong>Modes:</strong></p>
<p>Multiple modes can be used with space as separator:</p>
<ul>
<li><code>CLONE</code> - clone object and all extenders before extending, keeps the resulting
objects untouched (works only globally)</li>
<li><code>OVERWRITE</code> - allow overwrite of array and object mode in specific elements</li>
<li><code>ARRAY_CONCAT</code> - (default) if no other array-mode set, will concat additional
elements</li>
<li><code>ARRAY_REPLACE</code> - for all arrays, replace the previouse array completely instead
of extending them</li>
<li><code>ARRAY_OVERWRITE</code> - overwrite the same index instead of extending the array</li>
<li><code>OBJECT_EXTEND</code> - (default) if no other object-mode given, will add/replace
properties with the new ones</li>
<li><code>OBJECT_REPLACE</code> - will always replace the object completely with the new one,
if the keys are different</li>
</ul>
<p>This mode may also be changed on any specific element by giving a different mode
just for this operation in the extending element itself. Therefore an array
should has the mode as first element or an object as an attribute.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">extend = <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">(ext...)</span> -&gt;</span>
  indent += <span class="hljs-string">'   '</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>read mode</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  mode = []
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> ext[<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span> <span class="hljs-keyword">and</span> ext[<span class="hljs-number">0</span>]?.indexOf <span class="hljs-string">'MODE'</span> <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
    mode = ext.shift().split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1.</span>.]</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>return if no object given</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-keyword">unless</span> ext.length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>clone all if defined, and remove flag</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  ext = clone ext <span class="hljs-keyword">if</span> <span class="hljs-string">'CLONE'</span> <span class="hljs-keyword">in</span> mode
  mode = mode.filter (e) -&gt; e <span class="hljs-keyword">isnt</span> <span class="hljs-string">'CLONE'</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>run over extenders</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  obj = ext.shift()
  debug <span class="hljs-string">"<span class="hljs-subst">#{indent[<span class="hljs-number">3.</span>.]}</span>-&gt; extend <span class="hljs-subst">#{chalk.grey util.inspect obj}</span>"</span>
  debug <span class="hljs-string">"<span class="hljs-subst">#{indent[<span class="hljs-number">3.</span>.]}</span>   using mode: <span class="hljs-subst">#{mode.join <span class="hljs-string">', '</span>}</span>"</span> <span class="hljs-keyword">if</span> mode.length</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>use all extenders</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">for</span> src <span class="hljs-keyword">in</span> ext
    <span class="hljs-keyword">continue</span> <span class="hljs-keyword">unless</span> src?</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>empty source object</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">continue</span> <span class="hljs-keyword">if</span> src.constructor?.name <span class="hljs-keyword">is</span> Object.name <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> Object.keys(src).length
    debug <span class="hljs-string">"<span class="hljs-subst">#{indent[<span class="hljs-number">3.</span>.]}</span>   by <span class="hljs-subst">#{chalk.grey util.inspect src}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>undefined object</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">unless</span> obj?
      obj = src
      <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>arrays</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">if</span> Array.isArray src</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>check for changed mode</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      cmode = mode
      <span class="hljs-keyword">if</span> <span class="hljs-string">'OVERWRITE'</span> <span class="hljs-keyword">in</span> mode <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span> src[<span class="hljs-number">0</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span> <span class="hljs-keyword">and</span> src[<span class="hljs-number">0</span>][<span class="hljs-number">0.</span><span class="hljs-number">.4</span>] <span class="hljs-keyword">is</span> <span class="hljs-string">'MODE '</span>
        cmode = src.shift().split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1.</span>.]
        debug <span class="hljs-string">"<span class="hljs-subst">#{indent[<span class="hljs-number">3.</span>.]}</span>   change mode: <span class="hljs-subst">#{cmode.join <span class="hljs-string">', '</span>}</span>"</span>
      <span class="hljs-keyword">else</span> mode</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>extend depending on mode</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      <span class="hljs-keyword">if</span> <span class="hljs-string">'ARRAY_REPLACE'</span> <span class="hljs-keyword">in</span> cmode <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> Array.isArray obj
        obj = src
        <span class="hljs-keyword">continue</span>
      <span class="hljs-keyword">if</span> <span class="hljs-string">'ARRAY_OVERWRITE'</span> <span class="hljs-keyword">in</span> cmode
        obj[i] = extend <span class="hljs-string">"MODE <span class="hljs-subst">#{mode.join <span class="hljs-string">' '</span>}</span>"</span>, obj[i], n <span class="hljs-keyword">for</span> n, i <span class="hljs-keyword">in</span> src
        <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>default setting ARRAY_CONCAT</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      obj.push n <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> src
      <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>all other</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">unless</span> <span class="hljs-keyword">typeof</span> src <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>
      obj = src
      <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>this is a literal
check for changed mode</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    cmode = mode
    <span class="hljs-keyword">if</span> <span class="hljs-string">'OVERWRITE'</span> <span class="hljs-keyword">in</span> mode <span class="hljs-keyword">and</span> src.OBJECT_REPLACE
      cmode = [<span class="hljs-string">'OBJECT_REPLACE'</span>]
      <span class="hljs-keyword">delete</span> src.OBJECT_REPLACE
      debug <span class="hljs-string">"<span class="hljs-subst">#{indent[<span class="hljs-number">3.</span>.]}</span>   change mode: <span class="hljs-subst">#{cmode.join <span class="hljs-string">', '</span>}</span>"</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>replace if different type</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span>(obj?) <span class="hljs-keyword">or</span> Array.isArray(obj) <span class="hljs-keyword">or</span> <span class="hljs-keyword">typeof</span> obj <span class="hljs-keyword">isnt</span> <span class="hljs-string">'object'</span> <span class="hljs-keyword">or</span>
    obj.constructor.name <span class="hljs-keyword">isnt</span> Object.name
      obj = src
      <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>replace object</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">if</span> <span class="hljs-string">'OBJECT_REPLACE'</span> <span class="hljs-keyword">in</span> cmode <span class="hljs-keyword">and</span> Object.keys(obj).join(<span class="hljs-string">','</span>) <span class="hljs-keyword">isnt</span> Object.keys(src).join(<span class="hljs-string">','</span>)
      obj = src
      <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>extend based on OBJECT_EXTEND mode</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">for</span> own k, v <span class="hljs-keyword">of</span> src
      <span class="hljs-keyword">if</span> v <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">delete</span> obj[k]
        <span class="hljs-keyword">continue</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>test to assure a key like 'toString' won't map to the standard function</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">      obj[k] = <span class="hljs-keyword">if</span> k <span class="hljs-keyword">in</span> Object.keys(obj)
        <span class="hljs-keyword">if</span> mode.length
          extend <span class="hljs-string">"MODE <span class="hljs-subst">#{mode.join <span class="hljs-string">' '</span>}</span>"</span>, obj[k], v
        <span class="hljs-keyword">else</span>
          extend obj[k], v
      <span class="hljs-keyword">else</span>
        v</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>return resulting obj</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  indent = indent[<span class="hljs-number">3.</span>.]
  debug <span class="hljs-string">"<span class="hljs-subst">#{indent}</span>&lt;- <span class="hljs-subst">#{chalk.grey util.inspect obj}</span>"</span>
  obj</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
