<!DOCTYPE html>
<html>
<head>
  <title>javascript.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../", thisFile = "home/alex/github/node-util/report/metrics/assets/scripts/vendor/codemirror/javascript.js", defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io" onmouseover="lllogo.src='https://alinex.github.io/images/Alinex-200.png'" onmouseout="lllogo.src='https://alinex.github.io/images/Alinex-black-200.png'">
  <img name="lllogo" src="https://alinex.github.io/images/Alinex-black-200.png" width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png" style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog" class="btn btn-primary"><span class="glyphicon-cog"></span> Blog</a>
  <a href="http://alinex.github.io/code.html" class="btn btn-warning"><span class="glyphicon-pencil"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-util" title="Fork me on GitHub"></a><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>javascript.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>TODO actually recognize syntax of TypeScript constructs</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">defineMode</span><span class="p">(</span><span class="s2">&quot;javascript&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">parserConfig</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">indentUnit</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">indentUnit</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">jsonMode</span> <span class="o">=</span> <span class="nx">parserConfig</span><span class="p">.</span><span class="nx">json</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">isTS</span> <span class="o">=</span> <span class="nx">parserConfig</span><span class="p">.</span><span class="nx">typescript</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Tokenizer</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="kd">var</span> <span class="nx">keywords</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">function</span> <span class="nx">kw</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">style</span><span class="o">:</span> <span class="s2">&quot;keyword&quot;</span><span class="p">};}</span>
    <span class="kd">var</span> <span class="nx">A</span> <span class="o">=</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;keyword a&quot;</span><span class="p">),</span> <span class="nx">B</span> <span class="o">=</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;keyword b&quot;</span><span class="p">),</span> <span class="nx">C</span> <span class="o">=</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;keyword c&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">operator</span> <span class="o">=</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;operator&quot;</span><span class="p">),</span> <span class="nx">atom</span> <span class="o">=</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;atom&quot;</span><span class="p">,</span> <span class="nx">style</span><span class="o">:</span> <span class="s2">&quot;atom&quot;</span><span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">jsKeywords</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;if&quot;</span><span class="o">:</span> <span class="nx">A</span><span class="p">,</span> <span class="s2">&quot;while&quot;</span><span class="o">:</span> <span class="nx">A</span><span class="p">,</span> <span class="s2">&quot;with&quot;</span><span class="o">:</span> <span class="nx">A</span><span class="p">,</span> <span class="s2">&quot;else&quot;</span><span class="o">:</span> <span class="nx">B</span><span class="p">,</span> <span class="s2">&quot;do&quot;</span><span class="o">:</span> <span class="nx">B</span><span class="p">,</span> <span class="s2">&quot;try&quot;</span><span class="o">:</span> <span class="nx">B</span><span class="p">,</span> <span class="s2">&quot;finally&quot;</span><span class="o">:</span> <span class="nx">B</span><span class="p">,</span>
      <span class="s2">&quot;return&quot;</span><span class="o">:</span> <span class="nx">C</span><span class="p">,</span> <span class="s2">&quot;break&quot;</span><span class="o">:</span> <span class="nx">C</span><span class="p">,</span> <span class="s2">&quot;continue&quot;</span><span class="o">:</span> <span class="nx">C</span><span class="p">,</span> <span class="s2">&quot;new&quot;</span><span class="o">:</span> <span class="nx">C</span><span class="p">,</span> <span class="s2">&quot;delete&quot;</span><span class="o">:</span> <span class="nx">C</span><span class="p">,</span> <span class="s2">&quot;throw&quot;</span><span class="o">:</span> <span class="nx">C</span><span class="p">,</span>
      <span class="s2">&quot;var&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">),</span> <span class="s2">&quot;const&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">),</span> <span class="s2">&quot;let&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;var&quot;</span><span class="p">),</span>
      <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;function&quot;</span><span class="p">),</span> <span class="s2">&quot;catch&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;catch&quot;</span><span class="p">),</span>
      <span class="s2">&quot;for&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;for&quot;</span><span class="p">),</span> <span class="s2">&quot;switch&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;switch&quot;</span><span class="p">),</span> <span class="s2">&quot;case&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;case&quot;</span><span class="p">),</span> <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">),</span>
      <span class="s2">&quot;in&quot;</span><span class="o">:</span> <span class="nx">operator</span><span class="p">,</span> <span class="s2">&quot;typeof&quot;</span><span class="o">:</span> <span class="nx">operator</span><span class="p">,</span> <span class="s2">&quot;instanceof&quot;</span><span class="o">:</span> <span class="nx">operator</span><span class="p">,</span>
      <span class="s2">&quot;true&quot;</span><span class="o">:</span> <span class="nx">atom</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="o">:</span> <span class="nx">atom</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="o">:</span> <span class="nx">atom</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="o">:</span> <span class="nx">atom</span><span class="p">,</span> <span class="s2">&quot;NaN&quot;</span><span class="o">:</span> <span class="nx">atom</span><span class="p">,</span> <span class="s2">&quot;Infinity&quot;</span><span class="o">:</span> <span class="nx">atom</span>
    <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>Extend the 'normal' keywords with the TypeScript language extensions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isTS</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="nx">style</span><span class="o">:</span> <span class="s2">&quot;variable-3&quot;</span><span class="p">};</span>
      <span class="kd">var</span> <span class="nx">tsKeywords</span> <span class="o">=</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>object-like things</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="s2">&quot;interface&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;interface&quot;</span><span class="p">),</span>
        <span class="s2">&quot;class&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">),</span>
        <span class="s2">&quot;extends&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;extends&quot;</span><span class="p">),</span>
        <span class="s2">&quot;constructor&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;constructor&quot;</span><span class="p">),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>scope modifiers</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="s2">&quot;public&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;public&quot;</span><span class="p">),</span>
        <span class="s2">&quot;private&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;private&quot;</span><span class="p">),</span>
        <span class="s2">&quot;protected&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;protected&quot;</span><span class="p">),</span>
        <span class="s2">&quot;static&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;static&quot;</span><span class="p">),</span>

        <span class="s2">&quot;super&quot;</span><span class="o">:</span> <span class="nx">kw</span><span class="p">(</span><span class="s2">&quot;super&quot;</span><span class="p">),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>types</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="s2">&quot;string&quot;</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span> <span class="s2">&quot;any&quot;</span><span class="o">:</span> <span class="nx">type</span>
      <span class="p">};</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">attr</span> <span class="k">in</span> <span class="nx">tsKeywords</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">jsKeywords</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nx">tsKeywords</span><span class="p">[</span><span class="nx">attr</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">jsKeywords</span><span class="p">;</span>
  <span class="p">}();</span>

  <span class="kd">var</span> <span class="nx">isOperatorChar</span> <span class="o">=</span> <span class="sr">/[+\-*&amp;%=&lt;&gt;!?|]/</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">chain</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">state</span><span class="p">.</span><span class="nx">tokenize</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">f</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">nextUntilUnescaped</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">escaped</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">next</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">((</span><span class="nx">next</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">next</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">next</span> <span class="o">==</span> <span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">escaped</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">escaped</span> <span class="o">=</span> <span class="o">!</span><span class="nx">escaped</span> <span class="o">&amp;&amp;</span> <span class="nx">next</span> <span class="o">==</span> <span class="s2">&quot;\\&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">escaped</span><span class="p">;</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Used as scratch variables to communicate multiple values without
consing up tons of objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">content</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">ret</span><span class="p">(</span><span class="nx">tp</span><span class="p">,</span> <span class="nx">style</span><span class="p">,</span> <span class="nx">cont</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="nx">tp</span><span class="p">;</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">cont</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">style</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">jsTokenBase</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ch</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">==</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">||</span> <span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">chain</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">jsTokenString</span><span class="p">(</span><span class="nx">ch</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="sr">/[\[\]{}\(\),;\:\.]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ch</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="nx">ch</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">eat</span><span class="p">(</span><span class="sr">/x/i</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">stream</span><span class="p">.</span><span class="nx">eatWhile</span><span class="p">(</span><span class="sr">/[\da-f]/i</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">);</span>
    <span class="p">}</span>      
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="sr">/\d/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span> <span class="o">||</span> <span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">eat</span><span class="p">(</span><span class="sr">/\d/</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">stream</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;number&quot;</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stream</span><span class="p">.</span><span class="nx">eat</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">chain</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">jsTokenComment</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">stream</span><span class="p">.</span><span class="nx">eat</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">stream</span><span class="p">.</span><span class="nx">skipToEnd</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span> <span class="o">||</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">==</span> <span class="s2">&quot;keyword c&quot;</span> <span class="o">||</span>
               <span class="sr">/^[\[{}\(,;:]$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">nextUntilUnescaped</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">);</span>
        <span class="nx">stream</span><span class="p">.</span><span class="nx">eatWhile</span><span class="p">(</span><span class="sr">/[gimy]/</span><span class="p">);</span> <span class="c1">// &#39;y&#39; is &quot;sticky&quot; option in Mozilla</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="s2">&quot;string-2&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">stream</span><span class="p">.</span><span class="nx">eatWhile</span><span class="p">(</span><span class="nx">isOperatorChar</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">stream</span><span class="p">.</span><span class="nx">skipToEnd</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isOperatorChar</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">ch</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">stream</span><span class="p">.</span><span class="nx">eatWhile</span><span class="p">(</span><span class="nx">isOperatorChar</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">stream</span><span class="p">.</span><span class="nx">eatWhile</span><span class="p">(</span><span class="sr">/[\w\$_]/</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">word</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">current</span><span class="p">(),</span> <span class="nx">known</span> <span class="o">=</span> <span class="nx">keywords</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">keywords</span><span class="p">[</span><span class="nx">word</span><span class="p">];</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">known</span> <span class="o">&amp;&amp;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">!=</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ret</span><span class="p">(</span><span class="nx">known</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">known</span><span class="p">.</span><span class="nx">style</span><span class="p">,</span> <span class="nx">word</span><span class="p">)</span> <span class="o">:</span>
                     <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="nx">word</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">jsTokenString</span><span class="p">(</span><span class="nx">quote</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nextUntilUnescaped</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">quote</span><span class="p">))</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">tokenize</span> <span class="o">=</span> <span class="nx">jsTokenBase</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">jsTokenComment</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">maybeEnd</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">ch</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">next</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">maybeEnd</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">tokenize</span> <span class="o">=</span> <span class="nx">jsTokenBase</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">maybeEnd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ret</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">);</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Parser</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="kd">var</span> <span class="nx">atomicTypes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;atom&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;number&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;regexp&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">};</span>

  <span class="kd">function</span> <span class="nx">JSLexical</span><span class="p">(</span><span class="nx">indented</span><span class="p">,</span> <span class="nx">column</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">align</span><span class="p">,</span> <span class="nx">prev</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">indented</span> <span class="o">=</span> <span class="nx">indented</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">column</span> <span class="o">=</span> <span class="nx">column</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">prev</span> <span class="o">=</span> <span class="nx">prev</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">info</span> <span class="o">=</span> <span class="nx">info</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">align</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">align</span> <span class="o">=</span> <span class="nx">align</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">inScope</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">varname</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span><span class="p">;</span> <span class="nx">v</span><span class="p">;</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">varname</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">parseJS</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">style</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">cc</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">cc</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Communicate our context to the combinators.
(Less wasteful than consing up a hundred closures on every call.)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">state</span><span class="p">;</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">stream</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">;</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">cc</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">;</span>
  
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;align&quot;</span><span class="p">))</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">align</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">combinator</span> <span class="o">=</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">cc</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span> <span class="o">:</span> <span class="nx">jsonMode</span> <span class="o">?</span> <span class="nx">expression</span> <span class="o">:</span> <span class="nx">statement</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">combinator</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">content</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span><span class="nx">cc</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">cc</span><span class="p">[</span><span class="nx">cc</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">lex</span><span class="p">)</span>
          <span class="nx">cc</span><span class="p">.</span><span class="nx">pop</span><span class="p">()();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">inScope</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">content</span><span class="p">))</span> <span class="k">return</span> <span class="s2">&quot;variable-2&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">style</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Combinator utils</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="kd">var</span> <span class="nx">cx</span> <span class="o">=</span> <span class="p">{</span><span class="nx">state</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">column</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">marked</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">cc</span><span class="o">:</span> <span class="kc">null</span><span class="p">};</span>
  <span class="kd">function</span> <span class="nx">pass</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">cc</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">cont</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">pass</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="nx">varname</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span> <span class="o">=</span> <span class="s2">&quot;def&quot;</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span><span class="p">;</span> <span class="nx">v</span><span class="p">;</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">varname</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="nx">varname</span><span class="p">,</span> <span class="nx">next</span><span class="o">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span><span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Combinators</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="kd">var</span> <span class="nx">defaultVars</span> <span class="o">=</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;this&quot;</span><span class="p">,</span> <span class="nx">next</span><span class="o">:</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;arguments&quot;</span><span class="p">}};</span>
  <span class="kd">function</span> <span class="nx">pushcontext</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="p">{</span><span class="nx">prev</span><span class="o">:</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">vars</span><span class="o">:</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span><span class="p">};</span>
    <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span> <span class="o">=</span> <span class="nx">defaultVars</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">popcontext</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">localVars</span> <span class="o">=</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">vars</span><span class="p">;</span>
    <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">pushlex</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JSLexical</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">indented</span><span class="p">,</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">column</span><span class="p">(),</span> <span class="nx">type</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">,</span> <span class="nx">info</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">lex</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">poplex</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">state</span> <span class="o">=</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">prev</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">indented</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span><span class="p">;</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">poplex</span><span class="p">.</span><span class="nx">lex</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">expect</span><span class="p">(</span><span class="nx">wanted</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">expecting</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">wanted</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">wanted</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">pass</span><span class="p">();</span>
      <span class="k">else</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">statement</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;var&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;vardef&quot;</span><span class="p">),</span> <span class="nx">vardef1</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;keyword a&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span> <span class="nx">expression</span><span class="p">,</span> <span class="nx">statement</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;keyword b&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span> <span class="nx">statement</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">),</span> <span class="nx">block</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">functiondef</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;for&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">),</span> <span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">forspec1</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span>
                                      <span class="nx">poplex</span><span class="p">,</span> <span class="nx">statement</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;stat&quot;</span><span class="p">),</span> <span class="nx">maybelabel</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;switch&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span> <span class="nx">expression</span><span class="p">,</span> <span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="s2">&quot;switch&quot;</span><span class="p">),</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">),</span>
                                         <span class="nx">block</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;case&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;catch&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span> <span class="nx">pushcontext</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">),</span> <span class="nx">funarg</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span>
                                        <span class="nx">statement</span><span class="p">,</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">popcontext</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;stat&quot;</span><span class="p">),</span> <span class="nx">expression</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">expression</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">atomicTypes</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">functiondef</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;keyword c&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">maybeexpression</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">maybeexpression</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">),</span> <span class="nx">commasep</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="s2">&quot;]&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">),</span> <span class="nx">commasep</span><span class="p">(</span><span class="nx">objprop</span><span class="p">,</span> <span class="s2">&quot;}&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">maybeexpression</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/[;\}\)\],]/</span><span class="p">))</span> <span class="k">return</span> <span class="nx">pass</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">(</span><span class="nx">expression</span><span class="p">);</span>
  <span class="p">}</span>
    
  <span class="kd">function</span> <span class="nx">maybeoperator</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span> <span class="o">&amp;&amp;</span> <span class="sr">/\+\+|--/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="nx">expression</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">commasep</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">maybeoperator</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">),</span> <span class="nx">expression</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">maybeoperator</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">maybelabel</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">poplex</span><span class="p">,</span> <span class="nx">statement</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">(</span><span class="nx">maybeoperator</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">property</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span> <span class="o">=</span> <span class="s2">&quot;property&quot;</span><span class="p">;</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">objprop</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span> <span class="o">=</span> <span class="s2">&quot;property&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">atomicTypes</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span> <span class="nx">expression</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">commasep</span><span class="p">(</span><span class="nx">what</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">proceed</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">what</span><span class="p">,</span> <span class="nx">proceed</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">end</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
      <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expect</span><span class="p">(</span><span class="nx">end</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">commaSeparated</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="nx">end</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
      <span class="k">else</span> <span class="k">return</span> <span class="nx">pass</span><span class="p">(</span><span class="nx">what</span><span class="p">,</span> <span class="nx">proceed</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">block</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">(</span><span class="nx">statement</span><span class="p">,</span> <span class="nx">block</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">maybetype</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">typedef</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">typedef</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">){</span><span class="nx">cx</span><span class="p">.</span><span class="nx">marked</span> <span class="o">=</span> <span class="s2">&quot;variable-3&quot;</span><span class="p">;</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();}</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">vardef1</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">register</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">isTS</span> <span class="o">?</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">maybetype</span><span class="p">,</span> <span class="nx">vardef2</span><span class="p">)</span> <span class="o">:</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">vardef2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">pass</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">vardef2</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;=&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">vardef2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">vardef1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">forspec1</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;var&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">vardef1</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">),</span> <span class="nx">forspec2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">forspec2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">formaybein</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">forspec2</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">formaybein</span><span class="p">(</span><span class="nx">_type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">maybeoperator</span><span class="p">,</span> <span class="nx">forspec2</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">forspec2</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">forspec3</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">==</span> <span class="s2">&quot;in&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">expect</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">),</span> <span class="nx">forspec3</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">forspec3</span><span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">!=</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">expression</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">functiondef</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nx">register</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">functiondef</span><span class="p">);}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">pushlex</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">pushcontext</span><span class="p">,</span> <span class="nx">commasep</span><span class="p">(</span><span class="nx">funarg</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span><span class="p">),</span> <span class="nx">poplex</span><span class="p">,</span> <span class="nx">statement</span><span class="p">,</span> <span class="nx">popcontext</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">funarg</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nx">register</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="k">return</span> <span class="nx">isTS</span> <span class="o">?</span> <span class="nx">cont</span><span class="p">(</span><span class="nx">maybetype</span><span class="p">)</span> <span class="o">:</span> <span class="nx">cont</span><span class="p">();}</span>
  <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Interface</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">startState</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">basecolumn</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">tokenize</span><span class="o">:</span> <span class="nx">jsTokenBase</span><span class="p">,</span>
        <span class="nx">lastType</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">cc</span><span class="o">:</span> <span class="p">[],</span>
        <span class="nx">lexical</span><span class="o">:</span> <span class="k">new</span> <span class="nx">JSLexical</span><span class="p">((</span><span class="nx">basecolumn</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">indentUnit</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;block&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">),</span>
        <span class="nx">localVars</span><span class="o">:</span> <span class="nx">parserConfig</span><span class="p">.</span><span class="nx">localVars</span><span class="p">,</span>
        <span class="nx">context</span><span class="o">:</span> <span class="nx">parserConfig</span><span class="p">.</span><span class="nx">localVars</span> <span class="o">&amp;&amp;</span> <span class="p">{</span><span class="nx">vars</span><span class="o">:</span> <span class="nx">parserConfig</span><span class="p">.</span><span class="nx">localVars</span><span class="p">},</span>
        <span class="nx">indented</span><span class="o">:</span> <span class="mi">0</span>
      <span class="p">};</span>
    <span class="p">},</span>

    <span class="nx">token</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stream</span><span class="p">.</span><span class="nx">sol</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;align&quot;</span><span class="p">))</span>
          <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">align</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">state</span><span class="p">.</span><span class="nx">indented</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">indentation</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stream</span><span class="p">.</span><span class="nx">eatSpace</span><span class="p">())</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">tokenize</span><span class="p">(</span><span class="nx">stream</span><span class="p">,</span> <span class="nx">state</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;comment&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">style</span><span class="p">;</span>
      <span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">parseJS</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">style</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">stream</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">indent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">,</span> <span class="nx">textAfter</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">tokenize</span> <span class="o">==</span> <span class="nx">jsTokenComment</span><span class="p">)</span> <span class="k">return</span> <span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">Pass</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">tokenize</span> <span class="o">!=</span> <span class="nx">jsTokenBase</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">firstChar</span> <span class="o">=</span> <span class="nx">textAfter</span> <span class="o">&amp;&amp;</span> <span class="nx">textAfter</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">lexical</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lexical</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;stat&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">firstChar</span> <span class="o">==</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="nx">lexical</span> <span class="o">=</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">prev</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">closing</span> <span class="o">=</span> <span class="nx">firstChar</span> <span class="o">==</span> <span class="nx">type</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;vardef&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span> <span class="o">+</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span> <span class="o">||</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;form&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">firstChar</span> <span class="o">==</span> <span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;form&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span> <span class="o">+</span> <span class="nx">indentUnit</span><span class="p">;</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;stat&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span> <span class="o">+</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">==</span> <span class="s2">&quot;operator&quot;</span> <span class="o">||</span> <span class="nx">state</span><span class="p">.</span><span class="nx">lastType</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span> <span class="o">?</span> <span class="nx">indentUnit</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">info</span> <span class="o">==</span> <span class="s2">&quot;switch&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">closing</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span> <span class="o">+</span> <span class="p">(</span><span class="sr">/^(?:case|default)\b/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">textAfter</span><span class="p">)</span> <span class="o">?</span> <span class="nx">indentUnit</span> <span class="o">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">indentUnit</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lexical</span><span class="p">.</span><span class="nx">align</span><span class="p">)</span> <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">column</span> <span class="o">+</span> <span class="p">(</span><span class="nx">closing</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
      <span class="k">else</span> <span class="k">return</span> <span class="nx">lexical</span><span class="p">.</span><span class="nx">indented</span> <span class="o">+</span> <span class="p">(</span><span class="nx">closing</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">indentUnit</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">electricChars</span><span class="o">:</span> <span class="s2">&quot;:{}&quot;</span><span class="p">,</span>

    <span class="nx">jsonMode</span><span class="o">:</span> <span class="nx">jsonMode</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">defineMIME</span><span class="p">(</span><span class="s2">&quot;text/javascript&quot;</span><span class="p">,</span> <span class="s2">&quot;javascript&quot;</span><span class="p">);</span>
<span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">defineMIME</span><span class="p">(</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;javascript&quot;</span><span class="p">,</span> <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">defineMIME</span><span class="p">(</span><span class="s2">&quot;text/typescript&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;javascript&quot;</span><span class="p">,</span> <span class="nx">typescript</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
<span class="nx">CodeMirror</span><span class="p">.</span><span class="nx">defineMIME</span><span class="p">(</span><span class="s2">&quot;application/typescript&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;javascript&quot;</span><span class="p">,</span> <span class="nx">typescript</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
